import{f as be,a as _e}from"../chunks/C4UjQarL.js";import{o as we}from"../chunks/DpEXUL3V.js";import{ad as Q,g as T,u as ve,ae as ke,h as q,c as y,af as xe,ag as ye,ah as Re,a9 as ze,x as $,M as t,ai as u,ac as Ce,aj as n,ak as p,al as b,am as o}from"../chunks/D71uUo7P.js";import{d as Le}from"../chunks/CHmi1f7u.js";import{r as z}from"../chunks/Ce23aD7d.js";import{b as Ue}from"../chunks/CGR7nHXc.js";function ne(e,i,v=i){var d=new WeakSet;Q(e,"input",async c=>{var l=c?e.defaultValue:e.value;if(l=B(e)?H(l):l,v(l),y!==null&&d.add(y),await ke(),l!==(l=i())){var _=e.selectionStart,g=e.selectionEnd,w=e.value.length;if(e.value=l??"",g!==null){var m=e.value.length;_===g&&g===w&&m>w?(e.selectionStart=m,e.selectionEnd=m):(e.selectionStart=_,e.selectionEnd=Math.min(g,m))}}}),(q&&e.defaultValue!==e.value||ve(i)==null&&e.value)&&(v(B(e)?H(e.value):e.value),y!==null&&d.add(y)),T(()=>{var c=i();if(e===document.activeElement){var l=xe??y;if(d.has(l))return}B(e)&&c===H(e.value)||e.type==="date"&&!c&&!e.value||c!==e.value&&(e.value=c??"")})}function oe(e,i,v=i){Q(e,"change",d=>{var c=d?e.defaultChecked:e.checked;v(c)}),(q&&e.defaultChecked!==e.checked||ve(i)==null)&&v(e.checked),T(()=>{var d=i();e.checked=!!d})}function B(e){var i=e.type;return i==="number"||i==="range"}function H(e){return e===""?null:+e}function Oe(e,i,v=i){Q(e,"change",()=>{v(e.files)}),q&&e.files&&v(e.files),T(()=>{e.files=i()})}function ce(e,i){ye(window,["resize"],()=>Re(()=>i(window[e])))}var Pe=be('<div class="app svelte-1uha8ag"><div class="canvas-shell svelte-1uha8ag"><div class="canvas-inner svelte-1uha8ag"><canvas class="svelte-1uha8ag"></canvas></div></div> <aside class="panel svelte-1uha8ag"><header class="panel-header svelte-1uha8ag"><h1 class="svelte-1uha8ag">Pixelator + Quantizer</h1> <p class="svelte-1uha8ag">Upload an image and tweak the effect.</p></header> <div class="panel-body svelte-1uha8ag"><div class="control-group svelte-1uha8ag"><label for="file" class="svelte-1uha8ag">Image</label> <div class="file-input svelte-1uha8ag"><input id="file" type="file" accept="image/*" class="svelte-1uha8ag"/></div></div> <div class="control-row svelte-1uha8ag"><div class="control-toggle svelte-1uha8ag"><label for="pixelate" class="svelte-1uha8ag"><span class="svelte-1uha8ag">Pixelate</span> <input id="pixelate" type="checkbox" class="svelte-1uha8ag"/></label></div> <div class="control-slider svelte-1uha8ag"><label for="block" class="svelte-1uha8ag"><span>Block size</span> <input id="block" type="range" min="2" max="32" step="1" class="svelte-1uha8ag"/></label></div></div> <div class="control-row svelte-1uha8ag"><div class="control-toggle svelte-1uha8ag"><label for="quantize" class="svelte-1uha8ag"><span class="svelte-1uha8ag">Quantize</span> <input id="quantize" type="checkbox" class="svelte-1uha8ag"/></label></div> <div class="control-slider svelte-1uha8ag"><label for="palette" class="svelte-1uha8ag"><span>Palette size</span> <input id="palette" type="range" min="2" max="64" step="1" class="svelte-1uha8ag"/></label></div> <button class="download-button svelte-1uha8ag">Download</button></div></div></aside></div>');function Me(e,i){ze(i,!0);let v=p(null),d,c=null,l=p(null),_=p(!0),g=p(8),w=p(!0),m=p(16),x,f=0,h=0,C=null,L=!1,U=!1,R=null,A=p(0),F=p(0);we(()=>{typeof OffscreenCanvas<"u"&&(c=new OffscreenCanvas(0,0)),typeof Worker<"u"&&(R=new Worker(new URL(""+new URL("../workers/image-worker-CZF0tC3t.js",import.meta.url).href,import.meta.url),{type:"module"}),R.onmessage=a=>{const{width:s,height:r,buffer:k}=a.data,ie=t(l)?.getContext("2d");if(!ie||!t(l))return;const me=new Uint8ClampedArray(k),pe=new ImageData(me,s,r);ie.putImageData(pe,0,0),O()})}),$(()=>{if(!t(v))return;const a=t(v)[0];if(!a)return;console.log(`Loaded file: ${a.name}`),d=a.name;const s=URL.createObjectURL(a),r=new Image;r.src=s,r.onload=()=>{console.log(`Loaded image size: ${r.width} x ${r.height}`);try{de(r),P()}catch(k){console.error(k)}finally{URL.revokeObjectURL(s)}},r.onerror=()=>{console.error("Could not load image file."),URL.revokeObjectURL(s)}}),$(()=>{t(_),t(g),t(w),t(m),x&&(C!==null&&clearTimeout(C),C=window.setTimeout(()=>{P()},150))}),$(()=>{t(A),t(F),O()});function de(a){if(!c||!t(l))return;f=a.naturalWidth||a.width,h=a.naturalHeight||a.height;const s=c.getContext("2d");if(!s)return;c.width=f,c.height=h,s.clearRect(0,0,f,h),s.drawImage(a,0,0,f,h),x=s.getImageData(0,0,f,h);const r=t(l).getContext("2d");r&&(t(l).width=f,t(l).height=h,r.clearRect(0,0,f,h),O())}function O(){if(!t(l)||!f||!h)return;const a=t(l).parentElement;if(!a)return;const s=a.getBoundingClientRect(),r=Math.min(s.width/f,s.height/h,1);t(l).style.width=`${f*r}px`,t(l).style.height=`${h*r}px`}function P(){if(!(!R||!x)){if(L){U=!0;return}L=!0;try{const{width:a,height:s,data:r}=x;R.postMessage({width:a,height:s,data:r,doPixelate:t(_),blockSize:t(g),doQuantize:t(w),paletteSize:t(m)})}catch(a){console.error(a)}finally{L=!1,U&&(U=!1,P())}}}function ue(){if(!x)return;let a="output.png";if(d){const s=d.lastIndexOf(".");a=d.slice(0,s)+"_output"+d.slice(s)}t(l)?.toBlob(s=>{if(!s)return;const r=URL.createObjectURL(s),k=document.createElement("a");k.href=r,k.download=a,k.click(),URL.revokeObjectURL(r)},"image/png")}var S=Pe(),j=n(S),V=n(j),fe=n(V);Ue(fe,a=>b(l,a),()=>t(l)),o(V),o(j);var Z=u(j,2),G=u(n(Z),2),I=n(G),J=u(n(I),2),he=n(J);o(J),o(I);var W=u(I,2),D=n(W),K=n(D),N=u(n(K),2);z(N),o(K),o(D);var X=u(D,2),Y=n(X),ee=u(n(Y),2);z(ee),o(Y),o(X),o(W);var ae=u(W,2),E=n(ae),te=n(E),le=u(n(te),2);z(le),o(te),o(E);var M=u(E,2),se=n(M),re=u(n(se),2);z(re),o(se),o(M);var ge=u(M,2);ge.__click=ue,o(ae),o(G),o(Z),o(S),ce("innerWidth",a=>b(A,a,!0)),ce("innerHeight",a=>b(F,a,!0)),Oe(he,()=>t(v),a=>b(v,a)),oe(N,()=>t(_),a=>b(_,a)),ne(ee,()=>t(g),a=>b(g,a)),oe(le,()=>t(w),a=>b(w,a)),ne(re,()=>t(m),a=>b(m,a)),_e(e,S),Ce()}Le(["click"]);export{Me as component};
